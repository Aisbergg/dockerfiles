# aisberg/nginx
FROM ubuntu:17.04
MAINTAINER Andre Lehmann <aisberg@posteo.de>

# included from template-ubuntu ------------------------------------------------
INCLUDE ../template-ubuntu
#-------------------------------------------------------------------------------

RUN echo "deb http://archive.ubuntu.com/ubuntu/ zesty main universe\ndeb http://archive.ubuntu.com/ubuntu/ zesty-updates main universe\ndeb http://archive.ubuntu.com/ubuntu/ zesty-backports main universe\ndeb http://security.ubuntu.com/ubuntu/ zesty-security main universe\ndeb http://ppa.launchpad.net/nginx/development/ubuntu zesty main" > /etc/apt/sources.list &&\
    apt-key adv --keyserver ha.pool.sks-keyservers.net --recv-keys 8B3981E7A6852F782CC4951600A6F0A3C300EE8C &&\
    apt-get update &&\
    apt-get install -y \
        openssl \
        ca-certificates \
        nginx \
        libnginx-mod-http-auth-pam \
        libnginx-mod-http-geoip \
        libnginx-mod-http-image-filter \
        libnginx-mod-http-lua \
        libnginx-mod-http-ndk \
        libnginx-mod-http-perl \
        libnginx-mod-http-xslt-filter \
        libnginx-mod-mail \
        libnginx-mod-stream \
        libnginx-mod-http-cache-purge \
        libnginx-mod-http-echo \
        libnginx-mod-http-fancyindex \
        libnginx-mod-http-headers-more-filter \
        libnginx-mod-http-subs-filter \
        libnginx-mod-http-uploadprogress \
        libnginx-mod-http-upstream-fair \
        libnginx-mod-nchan \
        gettext-base &&\
    rm -rf /var/lib/apt/lists/* /var/www/html /etc/nginx/sites-available /etc/nginx/sites-enabled &&\
    ln -sf /dev/stdout /var/log/nginx/access.log &&\
    ln -sf /dev/stderr /var/log/nginx/error.log

COPY provision/ /provision

EXPOSE 80 443
